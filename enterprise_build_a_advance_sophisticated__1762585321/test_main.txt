<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Advanced Calculator</title>
    <link rel="stylesheet" href="styles.css">
</head>

<body>
    <div class="container">
        <div class="calculator">
            <div class="display">
                <div id="history"></div>
                <input type="text" id="result" value="0" readonly>
            </div>

            <div class="buttons">
                <button class="function-btn" data-action="clear">AC</button>
                <button class="function-btn" data-action="delete">DEL</button>
                <button class="operator-btn" data-value="÷">÷</button>
                <button class="number-btn" data-value="7">7</button>
                <button class="number-btn" data-value="8">8</button>
                <button class="number-btn" data-value="9">9</button>
                <button class="operator-btn" data-value="×">×</button>
                <button class="number-btn" data-value="4">4</button>
                <button class="number-btn" data-value="5">5</button>
                <button class="number-btn" data-value="6">6</button>
                <button class="operator-btn" data-value="−">−</button>
                <button class="number-btn" data-value="1">1</button>
                <button class="number-btn" data-value="2">2</button>
                <button class="number-btn" data-value="3">3</button>
                <button class="operator-btn" data-value="+">+</button>
                <button class="number-btn" data-value="0">0</button>
                <button class="number-btn" data-value=".">.</button>
                <button class="function-btn" data-action="plusMinus">±</button>
                <button class="equal-btn" data-action="calculate">=</button>

                <button class="advanced-btn" data-action="sqrt">√</button>
                <button class="advanced-btn" data-action="square">x²</button>
                <button class="advanced-btn" data-action="cube">x³</button>
                <button class="advanced-btn" data-action="power">x^y</button>
                <button class="advanced-btn" data-action="factorial">n!</button>
                <button class="advanced-btn" data-action="log">log</button>
                <button class="advanced-btn" data-action="ln">ln</button>
                <button class="advanced-btn" data-action="pi">π</button>
                <button class="advanced-btn" data-action="e">e</button>
                <button class="advanced-btn" data-action="sin">sin</button>
                <button class="advanced-btn" data-action="cos">cos</button>
                <button class="advanced-btn" data-action="tan">tan</button>
                <button class="advanced-btn" data-action="inv">inv</button>
                <button class="advanced-btn" data-action="memorySave">MS</button>
                <button class="advanced-btn" data-action="memoryRecall">MR</button>
                <button class="advanced-btn" data-action="memoryClear">MC</button>
                <button class="advanced-btn" data-action="memoryAdd">M+</button>
                <button class="advanced-btn" data-action="memorySubtract">M-</button>
            </div>
        </div>

        <div class="settings">
            <h2>Settings</h2>
            <label for="theme-switch">Dark Mode:</label>
            <input type="checkbox" id="theme-switch">
            <br>
            <label for="precision">Precision:</label>
            <select id="precision">
                <option value="2">2 Decimal Places</option>
                <option value="4">4 Decimal Places</option>
                <option value="6">6 Decimal Places</option>
                <option value="8">8 Decimal Places</option>
            </select>
        </div>

        <div class="history-panel">
            <h2>Calculation History</h2>
            <ul id="calculation-history">
            </ul>
            <button id="clear-history">Clear History</button>
        </div>
    </div>

    <div class="tooltip"></div>

    <script src="script.js"></script>
</body>

</html>
```
```css
body {
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    background: linear-gradient(to right, #4a00e0, #8e2de2);
    color: #fff;
    display: flex;
    justify-content: center;
    align-items: center;
    min-height: 100vh;
    margin: 0;
    padding: 0;
    transition: background 0.3s ease;
}

body.dark-mode {
    background: linear-gradient(to right, #2c3e50, #34495e);
    color: #ddd;
}

.container {
    display: flex;
    width: 90%;
    max-width: 1200px;
    margin: 20px;
    padding: 20px;
    background: rgba(255, 255, 255, 0.1);
    border-radius: 15px;
    box-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.3);
    backdrop-filter: blur(5px);
    -webkit-backdrop-filter: blur(5px);
    border: 1px solid rgba(255, 255, 255, 0.18);
    justify-content: space-around;
    align-items: flex-start;
    flex-wrap: wrap;
}

.calculator {
    width: 350px;
    border-radius: 15px;
    overflow: hidden;
    box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
    margin-bottom: 20px;
}

.display {
    background-color: rgba(0, 0, 0, 0.8);
    color: #fff;
    text-align: right;
    padding: 15px;
    font-size: 2em;
    border-bottom: 2px solid rgba(255, 255, 255, 0.1);
}

#history {
    font-size: 0.8em;
    color: rgba(255, 255, 255, 0.6);
    overflow: hidden;
    white-space: nowrap;
    text-overflow: ellipsis;
    max-height: 20px;
}

#result {
    border: none;
    background: none;
    color: #fff;
    font-size: 2em;
    width: 100%;
    text-align: right;
    padding: 0;
    margin: 0;
    outline: none;
}

.buttons {
    display: grid;
    grid-template-columns: repeat(4, 1fr);
    gap: 5px;
    padding: 10px;
    background-color: rgba(0, 0, 0, 0.5);
}

.buttons button {
    background-color: rgba(255, 255, 255, 0.1);
    color: #fff;
    border: none;
    padding: 15px;
    font-size: 1.2em;
    cursor: pointer;
    border-radius: 8px;
    transition: background-color 0.3s ease, transform 0.2s ease;
    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
    outline: none;
    min-height: 44px;
}

.buttons button:hover {
    background-color: rgba(255, 255, 255, 0.2);
}

.buttons button:active {
    transform: scale(0.95);
}

.operator-btn {
    background-color: rgba(255, 165, 0, 0.7);
}

.operator-btn:hover {
    background-color: rgba(255, 165, 0, 0.9);
}

.equal-btn {
    grid-column: span 1;
    background-color: rgba(46, 139, 87, 0.7);
}

.equal-btn:hover {
    background-color: rgba(46, 139, 87, 0.9);
}

.function-btn {
    background-color: rgba(128, 128, 128, 0.7);
}

.function-btn:hover {
    background-color: rgba(128, 128, 128, 0.9);
}

.advanced-btn {
    font-size: 1em;
    background-color: rgba(70, 130, 180, 0.5);
}

.advanced-btn:hover {
    background-color: rgba(70, 130, 180, 0.7);
}

.settings,
.history-panel {
    width: 300px;
    padding: 20px;
    background: rgba(255, 255, 255, 0.05);
    border-radius: 15px;
    box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
    backdrop-filter: blur(5px);
    -webkit-backdrop-filter: blur(5px);
    border: 1px solid rgba(255, 255, 255, 0.18);
    margin-left: 20px;
    margin-bottom: 20px;
}

.settings h2,
.history-panel h2 {
    margin-top: 0;
    margin-bottom: 15px;
    text-align: center;
    color: #eee;
}

.settings label {
    display: block;
    margin-bottom: 5px;
    color: #eee;
}

.settings input[type="checkbox"],
.settings select {
    margin-bottom: 15px;
    padding: 8px;
    border-radius: 5px;
    border: none;
    background-color: rgba(255, 255, 255, 0.2);
    color: #fff;
    width: 100%;
    box-sizing: border-box;
}

.settings select option {
    background-color: #333;
    color: #fff;
}

#calculation-history {
    list-style: none;
    padding: 0;
    margin: 0;
}

#calculation-history li {
    padding: 8px 12px;
    border-bottom: 1px solid rgba(255, 255, 255, 0.1);
    color: #ddd;
    overflow: hidden;
    white-space: nowrap;
    text-overflow: ellipsis;
}

#calculation-history li:last-child {
    border-bottom: none;
}

#clear-history {
    background-color: rgba(220, 20, 60, 0.7);
    color: #fff;
    border: none;
    padding: 10px 15px;
    font-size: 1em;
    cursor: pointer;
    border-radius: 8px;
    transition: background-color 0.3s ease, transform 0.2s ease;
    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
    outline: none;
    width: 100%;
    margin-top: 10px;
}

#clear-history:hover {
    background-color: rgba(220, 20, 60, 0.9);
}

#clear-history:active {
    transform: scale(0.95);
}

.tooltip {
    position: fixed;
    top: 0;
    left: 0;
    background-color: rgba(0, 0, 0, 0.8);
    color: #fff;
    padding: 10px;
    border-radius: 5px;
    font-size: 0.9em;
    z-index: 1000;
    visibility: hidden;
    opacity: 0;
    transition: opacity 0.3s ease;
    pointer-events: none;
}

.tooltip.show {
    visibility: visible;
    opacity: 1;
}

/* Media Queries for Responsiveness */
@media (max-width: 1024px) {
    .container {
        flex-direction: column;
        align-items: center;
    }

    .settings,
    .history-panel {
        width: 100%;
        margin-left: 0;
    }
}

@media (max-width: 768px) {
    .calculator {
        width: 100%;
    }

    .buttons {
        grid-template-columns: repeat(4, 1fr);
    }

    .buttons button {
        padding: 12px;
        font-size: 1em;
    }
}

@media (max-width: 480px) {
    .buttons button {
        padding: 10px;
        font-size: 0.9em;
    }

    .display {
        padding: 10px;
        font-size: 1.5em;
    }
}
```
```javascript
document.addEventListener('DOMContentLoaded', () => {
    const resultInput = document.getElementById('result');
    const historyDiv = document.getElementById('history');
    const buttons = document.querySelector('.buttons');
    const themeSwitch = document.getElementById('theme-switch');
    const precisionSelect = document.getElementById('precision');
    const calculationHistoryList = document.getElementById('calculation-history');
    const clearHistoryButton = document.getElementById('clear-history');
    const tooltip = document.querySelector('.tooltip');
    let memoryValue = 0;

    let history = [];

    function updateDisplay(value) {
        resultInput.value = value;
    }

    function updateHistory(expression) {
        historyDiv.textContent = expression;
    }

    function calculateResult(expression) {
        try {
            expression = expression.replace(/÷/g, '/').replace(/×/g, '*');

            // Security: Validate the expression before eval
            if (!isValidExpression(expression)) {
                throw new Error("Invalid Expression");
            }

            let result = eval(expression);

            if (!isFinite(result)) {
                throw new Error("Cannot divide by zero or result is undefined");
            }

            const precision = parseInt(precisionSelect.value);
            result = parseFloat(result.toFixed(precision));

            return result;
        } catch (error) {
            console.error(error);
            updateDisplay('Error');
            return null;
        }
    }

    function isValidExpression(expression) {
        // Disallow potentially harmful functions and characters
        const blacklist = [
            '=', // Assignment
            'import', // Node.js import
            'require', // Node.js require
            'process', // Node.js process
            'window', // Browser window object
            'document', // Browser document object
            'alert',
            'confirm',
            'prompt'
        ];

        for (const item of blacklist) {
            if (expression.includes(item)) {
                return false;
            }
        }

        // Only allow numbers, operators, parentheses, and basic math functions
        const allowedCharacters = /^[0-9+\-*/().\s]+$/;
        if (!allowedCharacters.test(expression)) {
            return false;
        }

        return true;
    }

    function factorial(n) {
        if (n === 0) return 1;
        if (n < 0) return NaN;
        let result = 1;
        for (let i = 1; i <= n; i++) {
            result *= i;
        }
        return result;
    }

    function addToHistory(expression, result) {
        const calculation = `${expression} = ${result}`;
        history.push(calculation);
        if (history.length > 10) {
            history.shift(); // Keep only the last 10 calculations
        }
        localStorage.setItem('calculationHistory', JSON.stringify(history));
        renderHistory();
    }

    function renderHistory() {
        calculationHistoryList.innerHTML = '';
        history.forEach(calculation => {
            const li = document.createElement('li');
            li.textContent = calculation;
            calculationHistoryList.appendChild(li);
        });
    }

    function clearHistory() {
        history = [];
        localStorage.removeItem('calculationHistory');
        renderHistory();
    }

    buttons.addEventListener('click', (event) => {
        const target = event.target;
        const value = target.dataset.value;
        const action = target.dataset.action;
        const currentInput = resultInput.value;

        if (target.tagName !== 'BUTTON') return;

        switch (action) {
            case 'number':
                if (currentInput === '0' || currentInput === 'Error') {
                    updateDisplay(value);
                } else {
                    updateDisplay(currentInput + value);
                }
                break;
            case 'operator':
                if (currentInput !== 'Error') {
                    updateDisplay(currentInput + value);
                    updateHistory(currentInput + value);
                }
                break;
            case 'clear':
                updateDisplay('0');
                updateHistory('');
                break;
            case 'delete':
                updateDisplay(currentInput.length > 1 ? currentInput.slice(0, -1) : '0');
                break;
            case 'calculate':
                if (currentInput !== 'Error') {
                    const expression = currentInput;
                    const result = calculateResult(expression);
                    if (result !== null) {
                        updateDisplay(result);
                        updateHistory('');
                        addToHistory(expression, result);
                    }
                }
                break;
            case 'plusMinus':
                if (currentInput !== '0' && currentInput !== 'Error') {
                    updateDisplay(parseFloat(currentInput) * -1);
                }
                break;
            case 'sqrt':
                if (currentInput !== 'Error') {
                    const num = parseFloat(currentInput);
                    if (num >= 0) {
                        const result = Math.sqrt(num);
                        updateDisplay(result);
                        addToHistory(`√(${num})`, result);

                    } else {
                        updateDisplay('Error');
                    }
                }
                break;
            case 'square':
                if (currentInput !== 'Error') {
                    const num = parseFloat(currentInput);
                    const result = Math.pow(num, 2);
                    updateDisplay(result);
                     addToHistory(`${num}²`, result);
                }
                break;
            case 'cube':
                if (currentInput !== 'Error') {
                    const num = parseFloat(currentInput);
                    const result = Math.pow(num, 3);
                    updateDisplay(result);
                     addToHistory(`${num}³`, result);
                }
                break;
            case 'power':
                updateDisplay(currentInput + '^');
                 updateHistory(currentInput + '^');
                break;
            case 'factorial':
                if (currentInput !== 'Error') {
                    const num = parseInt(currentInput);
                    if (Number.isInteger(num)) {
                        const result = factorial(num);
                        if (isNaN(result)) {
                            updateDisplay('Error');
                        } else {
                            updateDisplay(result);
                             addToHistory(`${num}!`, result);
                        }
                    } else {
                        updateDisplay('Error');
                    }
                }
                break;
            case 'log':
                if (currentInput !== 'Error') {
                    const num = parseFloat(currentInput);
                    if (num > 0) {
                        const result = Math.log10(num);
                        updateDisplay(result);
                         addToHistory(`log(${num})`, result);
                    } else {
                        updateDisplay('Error');
                    }
                }
                break;
            case 'ln':
                if (currentInput !== 'Error') {
                    const num = parseFloat(currentInput);
                    if (num > 0) {
                        const result = Math.log(num);
                        updateDisplay(result);
                         addToHistory(`ln(${num})`, result);
                    } else {
                        updateDisplay('Error');
                    }
                }
                break;
            case 'pi':
                updateDisplay(Math.PI);
                 addToHistory(`π`, Math.PI);
                break;
            case 'e':
                updateDisplay(Math.E);
                addToHistory(`e`, Math.E);
                break;
            case 'sin':
                 if (currentInput !== 'Error') {
                    const num = parseFloat(currentInput);
                    const result = Math.sin(num * Math.PI / 180); // Convert degrees to radians
                    updateDisplay(result);
                     addToHistory(`sin(${num})`, result);
                }
                break;
            case 'cos':
                 if (currentInput !== 'Error') {
                    const num = parseFloat(currentInput);
                    const result = Math.cos(num * Math.PI / 180); // Convert degrees to radians
                    updateDisplay(result);
                     addToHistory(`cos(${num})`, result);
                }
                break;
            case 'tan':
                 if (currentInput !== 'Error') {
                    const num = parseFloat(currentInput);
                    const result = Math.tan(num * Math.PI / 180); // Convert degrees to radians
                    updateDisplay(result);
                     addToHistory(`tan(${num})`, result);
                }
                break;
             case 'inv':
                if (currentInput !== 'Error') {
                    const num = parseFloat(currentInput);
                    if (num !== 0) {
                        const result = 1 / num;
                        updateDisplay(result);
                         addToHistory(`1/${num}`, result);
                    } else {
                        updateDisplay('Error');
                    }
                }
                break;
             case 'memorySave':
                memoryValue = parseFloat(currentInput) || 0;
                localStorage.setItem('memoryValue', memoryValue.toString());
                showTooltip('Value saved to memory', target);
                break;
            case 'memoryRecall':
                memoryValue = parseFloat(localStorage.getItem('memoryValue')) || 0;
                updateDisplay(memoryValue);
                showTooltip('Value recalled from memory', target);
                break;
            case 'memoryClear':
                memoryValue = 0;
                localStorage.removeItem('memoryValue');
                showTooltip('Memory cleared', target);
                break;
            case 'memoryAdd':
                memoryValue += parseFloat(currentInput) || 0;
                localStorage.setItem('memoryValue', memoryValue.toString());
                showTooltip('Added to memory', target);
                break;
            case 'memorySubtract':
                memoryValue -= parseFloat(currentInput) || 0;
                localStorage.setItem('memoryValue', memoryValue.toString());
                showTooltip('Subtracted from memory', target);
                break;

            default:
                break;
        }
    });

    themeSwitch.addEventListener('change', () => {
        document.body.classList.toggle('dark-mode');
        localStorage.setItem('theme', document.body.classList.contains('dark-mode') ? 'dark' : 'light');
    });

    precisionSelect.addEventListener('change', () => {
        localStorage.setItem('precision', precisionSelect.value);
    });

    clearHistoryButton.addEventListener('click', clearHistory);

    // Load saved settings
    const savedTheme = localStorage.getItem('theme');
    if (savedTheme === 'dark') {
        document.body.classList.add('dark-mode');
        themeSwitch.checked = true;
    }

    const savedPrecision = localStorage.getItem('precision');
    if (savedPrecision) {
        precisionSelect.value = savedPrecision;
    }

    const savedHistory = localStorage.getItem('calculationHistory');
    if (savedHistory) {
        history = JSON.parse(savedHistory);
        renderHistory();
    }

    function showTooltip(message, element) {
        tooltip.textContent = message;
        const rect = element.getBoundingClientRect();
        tooltip.style.top = (rect.top - 40) + 'px';
        tooltip.style.left = (rect.left + rect.width / 2 - tooltip.offsetWidth / 2) + 'px';
        tooltip.classList.add('show');

        setTimeout(() => {
            tooltip.classList.remove('show');
        }, 2000);
    }

    document.addEventListener('keydown', (event) => {
        const key = event.key;

        if (/[0-9]/.test(key)) {
            document.querySelector(`[data-value="${key}"]`).click();
        } else if (['+', '-', '*', '/'].includes(key)) {
            document.querySelector(`[data-value="${key}"]`).click();
        } else if (key === '.') {
            document.querySelector(`[data-value="."]`).click();
        } else if (key === 'Enter' || key === '=') {
            document.querySelector('[data-action="calculate"]').click();
        } else if (key === 'Backspace') {
            document.querySelector('[data-action="delete"]').click();
        } else if (key === 'Escape') {
            document.querySelector('[data-action="clear"]').click();
        } else if(key === 's'){
            document.querySelector('[data-action="sqrt"]').click();
        }
    });
});